(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[474],{8597:function(x,e,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blogs/fptplay",function(){return s(3718)}])},3718:function(x,e,s){"use strict";s.r(e);var $=s(5893),c=s(1217),n=s(5132),l=(0,c.Pi)(function(){return(0,$.jsx)(n.default,{title:"KHAI TH\xc1C API TỪ FPTPLAY",children:(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)("h2",{className:"text-uppercase pt-5 pb-4 text-bold",children:"Crawl data from website fptplay.vn"}),(0,$.jsxs)("div",{className:"text-justify",children:[(0,$.jsx)("a",{href:"https://github.com/hatienl0i261299/fptplay",target:"_blank",children:(0,$.jsx)("img",{width:"100%",id:"git_img",className:"center-image",src:"https://github-readme-stats.vercel.app/api/pin/?username=hatienl0i261299&repo=fptplay",alt:""})}),(0,$.jsx)("p",{className:"m-3",children:"Lời mở đầu chả biết n\xf3i g\xec, th\xf4i th\xec bật DEV MODE l\xean v\xe0 v\xe0o việc lu\xf4n cho nhanh n\xe0o."}),(0,$.jsx)("p",{className:"m-3",children:"T\xecm xem api n\xf3 requests l\xean server để lấy đường dẫn video l\xe0 g\xec đ\xe3."}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/WtLtJxhR/Capture.png",width:"100%",className:"open-img"}),(0,$.jsxs)("p",{className:"m-3",children:["M\xecnh c\xf3 t\xecm thấy api n\xe0y: ",(0,$.jsx)("b",{children:"https://api.fptplay.net/api/v6.2_w/stream/vod/5e4565ff2089bd011c334948/0/auto_vip?st=17X_PuG4sQ3u-gYS8HRdGQ&e=1620010196419&device=Chrome(version:90)"})]}),(0,$.jsx)("p",{className:"m-3",children:"Ở đ\xe2y ch\xfang ta c\xf3 thể thấy c\xe1c param n\xf3 truyền k\xe8m theo url l\xe0: "}),(0,$.jsxs)("ul",{className:"m-3",children:[(0,$.jsxs)("li",{children:[(0,$.jsx)("b",{children:"st"}),": Một gi\xe1 trị n\xe0o đ\xf3 m\xecnh hiện tại m\xecnh chưa t\xecm được, search global cũng ko thấy, c\xf3 lẽ n\xf3 lại phải render ra từ js rồi."]}),(0,$.jsxs)("li",{children:[(0,$.jsx)("b",{children:"e"}),": Gi\xe1 trị n\xe0y chắc l\xe0 timestamp rồi."]}),(0,$.jsxs)("li",{children:[(0,$.jsx)("b",{children:"device"}),": phi\xean bản của tr\xecnh duyệt."]})]}),(0,$.jsxs)("p",{className:"m-3",children:["Xem sơ qua th\xec c\xf3 vẻ chỉ c\xf3 c\xe1i ",(0,$.jsx)("b",{children:"st"})," kia l\xe0 phải đau đầu x\xedu."]}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/66YKS8Kk/Capture.png",width:"100%",className:"open-img"}),(0,$.jsxs)("p",{className:"m-3",children:["Oke giờ dặt ",(0,$.jsx)("b",{children:"XHR/fetch breakpoint"})," l\xe0 1 slug của url api tr\xean, VD ở đ\xe2y m\xecnh để l\xe0",(0,$.jsx)("b",{children:'"/auto_vip"'})]}),(0,$.jsx)("p",{className:"m-3",children:"Refresh lại trang web đ\xf3 để n\xf3 chạy n\xe0o."}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/3JVs5pcc/Capture.png",width:"100%",className:"open-img"}),(0,$.jsxs)("p",{className:"m-3",children:["Vậy l\xe0 khi tr\xecnh duyệt n\xf3 load đến slug ",(0,$.jsx)("b",{children:'"/auto_vip"'})," như ta đ\xe3 đặt ph\xeda tr\xean th\xec n\xf3 dừng lại."]}),(0,$.jsxs)("p",{className:"m-3",children:["Nhưng khi n\xe0y th\xec l\xfac đ\xf3 tr\xecnh duyệt n\xf3 đ\xe3 render xong đc m\xe3 ",(0,$.jsx)("b",{children:"st"})," kia rồi. V\xe0 n\xf3 đang chuẩn bị requests đến c\xe1c API kh\xe1c."]}),(0,$.jsx)("p",{className:"m-3",children:"Vậy n\xean ch\xfang ta lại đi lại c\xe1c function trước đ\xf3 m\xe0 n\xf3 đ\xe3 chạy qua xem c\xf3 g\xec kh\xf4ng."}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/L6tb77jn/Capture.png",width:"100%",className:"open-img"}),(0,$.jsx)("p",{className:"m-3",children:"Ta c\xf3 thể thấy đoạn n\xe0y n\xf3 c\xf3 gọi apiCaller với method GET."}),(0,$.jsx)("p",{className:"m-3",children:"Ch\xfang ta thử đặt breakpoint v\xe0o d\xf2ng n\xe0y, v\xe0 refresh lại trang xem thế n\xe0o."}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/V6ysfvkY/Capture.png",width:"100%",className:"open-img"}),(0,$.jsxs)("p",{className:"m-3",children:["Sau khi next đến c\xe1c function tiếp theo, th\xec m\xecnh thấy 1 function với c\xe1c param đầu v\xe0o l\xe0 ",(0,$.jsx)("b",{children:"(t, e, n, r)"}),". Trong đ\xf3 c\xf3 biến ",(0,$.jsx)("b",{children:"n"})," l\xe0 1 slug của API."]}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/xCPww1kp/Capture.png",width:"100%",className:"open-img"}),(0,$.jsxs)("p",{className:"m-3",children:["Tiếp theo th\xec n\xf3 gọi đến function n\xe0y với c\xe1c param l\xe0 ",(0,$.jsx)("b",{children:"slug của api"})," v\xe0 ",(0,$.jsx)("b",{children:"user agent"}),"."]}),(0,$.jsx)("p",{className:"m-3",children:"V\xe0 ta thử đặt 1 breakpoint v\xe0o chỗ n\xf3 return ra, rồi refresh lại trang web. Đồng thời xo\xe1 c\xe1c breakpoint cũ đi để n\xf3 đỡ phải chạy lại."}),(0,$.jsxs)("p",{className:"m-3",children:["Ta c\xf3 thể thấy d\xf2ng return n\xe0y ",(0,$.jsx)("b",{children:'return e.st = Object(c.a)(Object(l.a)(u)).replace(/\\+/g, "-").replace(/\\//g, "_").replace(/=/g, ""),'})," với c\xe1i mục ti\xean đang t\xecm c\xe1i ",(0,$.jsx)("b",{children:"st"})," kia th\xec m\xecnh kh\xe1 l\xe0 chắc chắn th\xec d\xf2ng n\xe0y l\xe0 d\xf2ng sẽ trả về đồng thời g\xe1n param st kia v\xe0o e."]}),(0,$.jsx)("p",{className:"m-3",children:"Ph\xe2n t\xedch qua d\xf2ng n\xe0y th\xec n\xf3 sẽ được xử l\xfd qua 3 func l\xe0:"}),(0,$.jsxs)("ul",{className:"m-3",children:[(0,$.jsxs)("li",{children:["Object(l.a)(u): c\xe1i n\xe0y c\xf3 lẽ n\xf3 sẽ gọi đến function ",(0,$.jsx)("b",{children:"l.a"})," v\xe0 biến truyền v\xe0o l\xe0 biến ",(0,$.jsx)("b",{children:"u"}),". C\xf2n",(0,$.jsx)("b",{children:"u"})," l\xe0 c\xe1i g\xec th\xec m\xecnh n\xf3i sau bi\xean dưới nh\xe9."]}),(0,$.jsxs)("li",{children:["Object(c.a): h\xe0m n\xe0y th\xec n\xf3 sẽ gọi đến h\xe0m ",(0,$.jsx)("b",{children:"c.a"})," v\xe0 param đẩu v\xe0o th\xec ch\xednh l\xe0 đầu ra của h\xe0m",(0,$.jsx)("b",{children:"l.a"}),"n\xf3i ở tr\xean."]}),(0,$.jsx)("li",{children:"C\xf2n c\xe1c h\xe0m replace sau đ\xf3 th\xec chỉ l\xe0 thay đổi c\xe1c k\xfd tự đi, n\xean m\xecnh quan t\xe2m n\xf3 sau cũng đc."})]}),(0,$.jsxs)("p",{className:"m-3",children:["Nh\xecn v\xe0o phần ở tr\xean ta c\xf3 thể thấy ngay c\xe1i ",(0,$.jsx)("b",{children:"u"})," kia được tạo ra bằng c\xe1ch ",(0,$.jsx)("b",{children:"u = this.api_token + o + this.suffix + a;"})]}),(0,$.jsxs)("ul",{className:"m-3",children:[(0,$.jsx)("li",{className:"text-bold",children:"this.api_token = WEBv6Dkdsad90dasdjlALDDDS (N\xf3 đ\xe3 được khởi tạo ở d\xf2ng tr\xean nh\xe9)"}),(0,$.jsx)("li",{className:"text-bold",children:"o = Math.floor((new Date).getTime()) + 10800 (l\xe0 thời gian cộng với 10800 th\xf4i)"}),(0,$.jsx)("li",{className:"text-bold",children:"this.suffix = /api/v6.2_w/ (c\xe1i n\xe0y l\xe0 1 slug của api)"}),(0,$.jsx)("li",{className:"text-bold",children:"a cũng l\xe0 1 slug của api, VD ở tr\xean c\xf3 thể l\xe0 auto_vip."})]}),(0,$.jsxs)("p",{className:"m-3",children:["Oke vậy l\xe0 t\xecm được c\xe1i ",(0,$.jsx)("b",{children:"u"}),", giờ ta t\xecm h\xe0m đầu ti\xean xem n\xf3 l\xe0 g\xec, h\xe0m ",(0,$.jsx)("b",{children:"l.a"})]}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/PJpBPz39/Capture.png",width:"100%",className:"open-img"}),(0,$.jsxs)("p",{className:"m-3",children:["T\xecm đến h\xe0m ",(0,$.jsx)("b",{children:"l.a"})," với biến đầu v\xe0o l\xe0 ",(0,$.jsx)("b",{children:"u"})," th\xec n\xf3 ra h\xe0m n\xe0y. Nh\xecn qua c\xf3 lẽ l\xe0 1 h\xe0m băm n\xe0o đ\xf3. M\xe0 những h\xe0m băm th\xf4ng dụng nhất hiện n\xe0y l\xe0 ",(0,$.jsx)("b",{children:"MD5, SHA256, SHA512"})]}),(0,$.jsxs)("p",{className:"m-3",children:["V\xec m\xecnh c\xf3 biết 1 ch\xfat về mật m\xe3 học n\xean c\xf3 biết c\xe1i n\xe0y l\xe0 sử dụng ",(0,$.jsx)("b",{children:"MD5"}),"."]}),(0,$.jsx)("p",{className:"m-3",children:"Nếu c\xe1c bạn ko biết th\xec c\xf3 thể thử từng loại h\xe0m băm, v\xe0 so s\xe1nh với kết quả trả về của trang web, n\xean kết quả trả về giống nhau th\xec c\xf3 thể biết n\xf3 d\xf9ng h\xe0m băm g\xec rồi."}),(0,$.jsxs)("p",{className:"m-3",children:["Vậy chốt lại l\xe0 ta t\xecm được h\xe0m ",(0,$.jsx)("b",{children:"l.a"})," kia ch\xednh l\xe0 băm c\xe1i ",(0,$.jsx)("b",{children:"u"})," kia với thuật to\xe1n l\xe0",(0,$.jsx)("b",{children:"MD5"}),"."]}),(0,$.jsxs)("p",{className:"m-3",children:["Giờ c\xf4ng việc tiếp theo l\xe0 t\xecm đến h\xe0m ",(0,$.jsx)("b",{children:"c.a"})," v\xe0 biết đầu v\xe0o cho h\xe0m ",(0,$.jsx)("b",{children:"c.a"})," n\xe0y th\xec ch\xednh l\xe0 gi\xe1 trị sau khi băm ",(0,$.jsx)("b",{children:"MD5"})," từ h\xe0m ",(0,$.jsx)("b",{children:"l.a"})]}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/NFZSv94t/Capture.png",width:"100%",className:"open-img"}),(0,$.jsxs)("p",{className:"m-3",children:["V\xe0o h\xe0m ",(0,$.jsx)("b",{children:"c.a"})," th\xec n\xf3 ra thế n\xe0y."]}),(0,$.jsx)("p",{className:"m-3",children:"Ph\xe2n t\xedch qua th\xec m\xecnh cũng ko biết n\xf3 x\xe0i thuật to\xe1n g\xec cả. Chắc m\xecnh vẫn c\xf2n g\xe0 mờ. Vậy th\xec nghi\xean cứu v\xe0 ph\xe2n t\xedch h\xe0m n\xe0y vậy."})]}),(0,$.jsx)("pre",{children:'\n    var e = function(t, e) {\n        t = t.toUpperCase(),\n        e && (t = t.replace(/0x/gi, ""));\n        var n = t;\n        t = t.replace(/[^A-Fa-f0-9]/g, ""),\n        n != t && console.log("Warning! Non-hex characters in input string ignored.");\n        return t\n                '}),(0,$.jsxs)("p",{className:"m-3",children:["Đầu ti\xean l\xe0 c\xe1i ",(0,$.jsx)("b",{children:"function e"})," n\xe0y. C\xe1i n\xe0y n\xf3 sẽ nhận biến đầu v\xe0o l\xe0 gi\xe1 trị băm ",(0,$.jsx)("b",{children:"MD5"}),"ở ph\xeda tr\xean."]}),(0,$.jsx)("p",{className:"m-3",children:"Sau đ\xf3 toUpperCase (chuyển đổi viết hoa c\xe1c k\xfd tự đ\xf3). V\xe0 replace c\xe1c k\xfd tự."}),(0,$.jsx)("pre",{children:"\n    for (var n = new Array, a = 0; a < e.length / 2; a++) {\n        var i = e.substr(2 * a, 2);\n        n[a] = parseInt(i, 16)\n    }\n                "}),(0,$.jsxs)("p",{className:"m-3",children:["Sau khi được chuỗi k\xfd tự đ\xe3 uppercase th\xec v\xf2ng for n\xe0y sẽ lấy 2 k\xfd tự li\xean ti\xe9p nhau trong chuỗi đ\xf3, ",(0,$.jsx)("b",{children:"parseInt(i, 16)"})," chuyển đổi ",(0,$.jsx)("b",{children:"Hexadecimal to Decimal"})," v\xe0 c\xe1c gi\xe1 trị sau khi chuyển đổi sẽ được đưa v\xe0o ",(0,$.jsx)("b",{children:"Array n"}),"."]}),(0,$.jsxs)("p",{className:"m-3",children:["Ở dưới l\xe0 c\xe1c d\xf2ng lệnh để xử l\xfd ",(0,$.jsx)("b",{children:"Array n"})," đ\xe3 được tạo ra ở tr\xean. V\xe0 c\xf3 1 số lệnh như: "]}),(0,$.jsxs)("ul",{children:[(0,$.jsxs)("li",{children:[(0,$.jsx)("b",{children:"charAt"}),": k\xfd tự tại 1 vị tr\xed n\xe0o đ\xf3 trong 1 mảng."]}),(0,$.jsxs)("li",{children:[(0,$.jsx)("b",{children:" >> v\xe0 << "}),": Dịch bit sang tr\xe1i hoặc sang phải. VD: 2 << 5 - Dịch sang tr\xe1i 5 bit, 2 >> 5 - Dịch sang phải 5 bit"]})]}),(0,$.jsx)("p",{className:"m-3",children:"Oke vậy l\xe0 giải quyết được hết c\xe1c vấn đề rồi, giờ code lại xem như thế n\xe0o."}),(0,$.jsxs)("p",{className:"m-3",children:["Dưới đ\xe2y l\xe0 h\xe0m ",(0,$.jsx)("b",{children:"c.a"})," m\xecnh c\xf3 viết lại bằng ",(0,$.jsx)("b",{children:"python"})]}),(0,$.jsx)("pre",{children:"\n    def encrypt(e):\n        n = []\n        t = e.upper()\n        r = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\n        for o in range(int(len(t) / 2)):\n            i = t[2 * o:2 * o + 2]\n            num = '0x%s' % i\n            n.append(int(num, 16))\n\n        def convert(e):\n            t = \"\"\n            n = 0\n            o = 0\n            i = [0, 0, 0]\n            a = [0, 0, 0, 0]\n            s = len(e)\n            c = 0\n            for z in range(s, 0, -1):\n                if n <= 3:\n                    i[n] = e[c]\n                n += 1\n                c += 1\n                if 3 == n:\n                    a[0] = (252 & i[0]) >> 2\n                    a[1] = ((3 & i[0]) << 4) + ((240 & i[1]) >> 4)\n                    a[2] = ((15 & i[1]) << 2) + ((192 & i[2]) >> 6)\n                    a[3] = (63 & i[2])\n                    for v in range(4):\n                        t += r[a[v]]\n                    n = 0\n            if n:\n                for o in range(n, 3, 1):\n                    i[o] = 0\n\n                for o in range(n + 1):\n                    a[0] = (252 & i[0]) >> 2\n                    a[1] = ((3 & i[0]) << 4) + ((240 & i[1]) >> 4)\n                    a[2] = ((15 & i[1]) << 2) + ((192 & i[2]) >> 6)\n                    a[3] = (63 & i[2])\n                    t += r[a[o]]\n                n += 1\n                while n < 3:\n                    t += \"=\"\n                    n += 1\n            return t\n        return convert(n).replace('+', '-').replace('/', '_').replace('=', '')\n                "}),(0,$.jsx)("img",{alt:"",src:"https://i.postimg.cc/nrYkLXKB/Capture.png",width:"100%",className:"open-img"}),(0,$.jsx)("p",{className:"m-3",children:"V\xe0 đ\xe2y l\xe0 th\xe0nh quả."}),(0,$.jsxs)("p",{className:"m-3",children:["Cụ thể code tại: ",(0,$.jsx)("a",{href:"https://github.com/hatienl0i261299/fptplay",target:"_blank",children:"Đ\xe2y"})]})]})})});e.default=l}},function(x){x.O(0,[662,461,563,132,774,888,179],function(){return x(x.s=8597)}),_N_E=x.O()}])